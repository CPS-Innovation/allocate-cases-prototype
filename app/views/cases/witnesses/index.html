{% extends "layouts/main.html" %}
{% set navId = 'cases' %}
{% set secondaryNavId = 'witnesses' %}
{% set pageName = 'Witnesses' %}

{% block beforeContent %}
  {% include "_includes/case-identity-bar.njk" %}
{% endblock %}

{% block content %}
  {% include "_includes/success-banner.njk" %}
  {% include "_includes/case-navigation.njk" %}

  <div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
      <h1 class="govuk-heading-l">{{pageName}}</h1>
      
      {% if _case.witnesses.length %}
         {# <div class="app-list"> #}
          {% for witness in _case.witnesses %}
            <div class="govuk-summary-card">
              <div class="govuk-summary-card__title-wrapper">
                <h2 class="govuk-summary-card__title govuk-!-font-size-27">
                  {{witness.firstName}} {{witness.lastName}}

                  {{ govukTag({
                    classes: 'govuk-!-margin-left-1',
                    text: "Key witness"
                  }) if 1 == [1,2] | random }}

                  {{ govukTag({
                    classes: 'govuk-!-margin-left-1',
                    text: "Previous convictions"
                  }) if 1 == [1,2] | random }}
                </h2>
              </div>
              <div class="govuk-summary-card__content">
                {{ xGovukSecondaryNavigation({
                  classes: 'govuk-!-margin-bottom-5',
                  visuallyHiddenTitle: "Secondary menu",
                  items: [{
                    text: "Court details and statements",
                    href: "#",
                    current: true
                  }, {
                    text: "Witness details",
                    href: "#"
                  }, {
                    text: "Availability",
                    href: "#"
                  }, {
                    text: "Special measures",
                    href: "#"
                  }]
                })}}


                 <h3 class="govuk-heading-m">Court details</h3>

                {% if witness.appearingInCourt == true %}
                  <p>Witness called.</p>
                  <p><a href="/cases/{{_case.id}}/witnesses/{{witness.id}}/mark-as-not-appearing-in-court">Dewarn witness</a></p>
                {% elseif witness.appearingInCourt == false %}
                  <p>Witness dewarned.</p>
                  <p><a href="/cases/{{_case.id}}/witnesses/{{witness.id}}/mark-as-appearing-in-court">Call witness</a></p>
                {% else %}
                  <p><a href="/cases/{{_case.id}}/witnesses/{{witness.id}}/mark-as-appearing-in-court">Call witness</a></p>
                {% endif %}

                {{ govukSummaryList({
                  classes: 'app-summary-list--compac app-summary-list--small-tex govuk-!-margin-bottom-5',
                  rows: [
                    {
                      key: {
                        html: 'Is the witness appearing in court?'
                      },
                      value: {
                        html: witness.appearingInCourt
                      },
                      actions: {
                        items: [{
                          text: 'Change',
                          href: '/cases/:caseId/witnesses/:witnessId/edit-appearing-in-court' | replace(':caseId', _case.id) | replace(':witnessId', witness.id),
                          visuallyHiddenText: 'if you want to serve a section 9'
                        }]
                      }
                    }            
                  ]
                }) if 1==2}}

                {% if witness.statements.length > 0 %}


                  {% for statement in witness.statements %}
                    <h3 class="govuk-heading-m">Statement {{loop.index}}</h3>

                    {% if statement.serveSection9 == true %}
                      <p>Served as Section 9.</p>
                      <p><a href="/cases/{{_case.id}}/witnesses/{{witness.id}}/statements/{{statement.id}}/withdraw-section9">Withdraw section 9</a></p>
                    {% elseif statement.serveSection9 == false %}
                      <p>Section 9 withdrawn.</p>
                      <p><a href="/cases/{{_case.id}}/witnesses/{{witness.id}}/statements/{{statement.id}}/issue-section9">Serve as Section 9</a></p>
                    {% else %}
                      <p><a href="/cases/{{_case.id}}/witnesses/{{witness.id}}/statements/{{statement.id}}/issue-section9">Serve as Section 9</a></p>
                    {% endif %}

                    {% if statement.useInCourt == true %}                    
                      {% set useInCourtValue = 'Using' %}
                    {% elseif statement.useInCourt == false %}
                      {% set useInCourtValue = 'Not using' %}
                    {% else %}
                      {% set useInCourtValue = 'Not entered' %}
                    {% endif %}


                    {{ govukSummaryList({
                      classes: 'app-summary-list--compac app-summary-list--small-tex govuk-!-margin-bottom-5',
                      rows: [
                        {
                          key: {
                            html: 'Statement number'
                          },
                          value: {
                            html: loop.index
                          }
                        },
                        {
                          key: {
                            html: 'Statement'
                          },
                          value: {
                            html: '<a href="">statement.pdf</a>'
                          }
                        },
                        {
                          key: {
                            html: 'Using as evidence'
                          },
                          value: {
                            html: useInCourtValue
                          }
                        },
                        {
                          key: {
                            html: 'CPS disclosure assessment'
                          },
                          value: {
                            html: 'Evidence'
                          }
                        }
                                     
                      ]
                    })}}

                  {% endfor %}
                {% else %}
                  <h3 class="govuk-heading-s">Statements</h3>
                  <p class="govuk-!-font-size-16">No statements.</p>
                {% endif %}


              </div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <p>There are no witnesses.</p>
      {% endif %}

    </div>
  </div>
{% endblock %}
